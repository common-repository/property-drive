var FooPicker=function(){"use strict";function e(){function e(){s.monthChange=!1,s.hidePicker()}var d,s=this,o={className:"foopicker",dateFormat:"dd-MMM-yyyy",disable:[]};arguments[0]&&"object"==typeof arguments[0]&&(s.options=a(o,arguments[0]),d=s.options.id),s.showPicker=function(){s.buildPicker();var e=document.getElementById(d),t=document.getElementById("foopicker-"+d);if(e){var n=e.getBoundingClientRect(),a=n.left,r=n.bottom-7;t&&(t.style.position="fixed",t.style.top=r+"px",t.style.left=a+"px",t.style.zIndex="99999")}},s.hidePicker=function(){setTimeout(function(){var e,t;s.monthChange||s.isPickerClicked?s.isPickerClicked||(t=document.getElementById(s.options.id),t&&t.focus(),s.monthChange=!1):(s.removeListeners(d),e=document.getElementById("foopicker-"+d),e.removeEventListener("click",self.handlePickerClick,!1),e&&(e.innerHTML=""),s.isDateClicked=!1)},210)},s.selectDate=function(e){s.monthChange=!1;var n=document.getElementById(e.target.id),a=document.getElementById(d);if(n){n.classList.add("foopicker__day--selected");var r=t(s,n.dataset.day,n.dataset.month,n.dataset.year);s.selectedDate=r,s.selectedDay=parseInt(n.dataset.day),s.selectedMonth=parseInt(n.dataset.month),s.selectedYear=parseInt(n.dataset.year),a&&(a.value=r,a.focus(),setTimeout(function(){a.blur()},100))}s.isPickerClicked=!1,s.isDateClicked=!0,s.hidePicker()},s.removeListeners=function(t){var n=document.getElementById(t);if(n){var a=n.getElementsByClassName("foopicker__day");if(a&&a.length)for(var r=0;r<a.length;r++)if("function"==typeof a[r].onclick){var d=document.getElementById(t+"-foopicker__day--"+(r+1));u(d,"click",s.selectDate,!1)}}document.removeEventListener("keydown",e,!1);var o=document.getElementsByTagName("html")[0];o.removeEventListener("click",s.handleDocumentClick,!1)},s.changeMonth=function(e){var t=e.target.className,n=!1;-1!==t.indexOf("foopicker__arrow--next")&&(n=!0);var a=n?s.currentMonth+1:s.currentMonth-1;s.updateCalendar(a)},s.updateCalendar=function(e,t){s.monthChange=!0;var n=s.currentDate,a=t||s.currentYear;s.currentMonth=e,f.date=new Date(a,e,n);var r=document.getElementById("foopicker-"+d);if(r){var o=r.querySelector(".foopicker");o.innerHTML=f.buildHeader()+f.buildCalendar(),s.isPickerClicked=!1,f.removeListeners(s),f.addListeners(s)}},s.buildPicker=function(){var a=document.getElementById("foopicker-"+d),r=document.getElementById(d);if(a&&!l(a)){var o,i;o=document.createDocumentFragment(),i=document.createElement("div"),i.className=s.options.className;var c;r&&r.value&&r.value.length>=10?(c=n(s,r.value),s.selectedDay=c.getDate(),s.selectedMonth=c.getMonth()+1,s.selectedYear=c.getFullYear(),s.selectedDate=t(s,c.getDate(),c.getMonth()+1,c.getFullYear())):(s.selectedDate=null,s.selectedDay=null,s.selectedMonth=null,s.selectedYear=null,c=new Date),f.date=c,i.innerHTML=f.buildHeader()+f.buildCalendar(),o.appendChild(i),a.appendChild(o),f.addListeners(s),y(a,"click",s.handlePickerClick,!1)}document.addEventListener("keydown",e,!1);var u=document.getElementsByTagName("html")[0];y(u,"click",s.handleDocumentClick,!1)},s.handlePickerClick=function(e){e.stopPropagation(),s.isDateClicked||(s.isPickerClicked=!0)},s.handleDocumentClick=function(e){var t=document.getElementById(s.options.id),n=document.getElementById("foopicker-"+s.options.id);s.isPickerClicked=!1,s.monthChange=!1,e.target!==t&&e.target!==n&&s.hidePicker()},s.buildTemplate=function(){var e=document.createElement("div");e.id="foopicker-"+d,document.body.appendChild(e),r(s)},s.destroy=function(){var e=document.getElementById("foopicker-"+d);e&&document.body.removeChild(e)},s.buildTemplate()}function t(e,t,n,a){switch(t=10>t?"0"+t:t,n=10>n?"0"+n:n,e.options.dateFormat){case"dd-MM-yyyy":return t+"-"+n+"-"+a;case"dd-MMM-yyyy":return t+"-"+d(parseInt(n))+"-"+a;case"dd.MM.yyyy":return t+"."+n+"."+a;case"dd.MMM.yyyy":return t+"."+d(parseInt(n))+"."+a;case"dd/MM/yyyy":return t+"/"+n+"/"+a;case"dd/MMM/yyyy":return t+"/"+d(parseInt(n))+"/"+a;case"MM-dd-yyyy":return n+"-"+t+"-"+a;case"MM.dd.yyyy":return n+"."+t+"."+a;case"MM/dd/yyyy":return n+"/"+t+"/"+a;case"yyyy-MM-dd":return a+"-"+n+"-"+t;case"yyyy-MMM-dd":return a+"-"+d(parseInt(n))+"-"+t;case"yyyy.MM.dd":return a+"."+n+"."+t;case"yyyy.MMM.dd":return a+"."+d(parseInt(n))+"."+t;case"yyyy/MM/dd":return a+"/"+n+"/"+t;case"yyyy/MMM/dd":return a+"/"+d(parseInt(n))+"/"+t;default:return t+"-"+d(parseInt(n))+"-"+a}}function n(e,t){var n,a;switch(e.options.dateFormat){case"dd-MM-yyyy":return a=t.split("-"),n=new Date(parseInt(a[2]),parseInt(a[1])-1,parseInt(a[0]));case"dd-MMM-yyyy":return a=t.split("-"),n=new Date(parseInt(a[2]),s(a[1]),parseInt(a[0]));case"dd.MM.yyyy":return a=t.split("."),n=new Date(parseInt(a[2]),parseInt(a[1])-1,parseInt(a[0]));case"dd.MMM.yyyy":return a=t.split("."),n=new Date(parseInt(a[2]),s(a[1]),parseInt(a[0]));case"dd/MM/yyyy":return a=t.split("/"),n=new Date(parseInt(a[2]),parseInt(a[1])-1,parseInt(a[0]));case"dd/MMM/yyyy":return a=t.split("/"),n=new Date(parseInt(a[2]),s(a[1]),parseInt(a[0]));case"MM-dd-yyyy":return a=t.split("-"),n=new Date(parseInt(a[2]),parseInt(a[0])-1,parseInt(a[1]));case"MM.dd.yyyy":return a=t.split("."),n=new Date(parseInt(a[2]),parseInt(a[0])-1,parseInt(a[1]));case"MM/dd/yyyy":return a=t.split("/"),n=new Date(parseInt(a[2]),parseInt(a[0])-1,parseInt(a[1]));case"yyyy-MM-dd":return a=t.split("-"),n=new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]));case"yyyy-MMM-dd":return a=t.split("-"),n=new Date(parseInt(a[0]),s(a[1]),parseInt(a[2]));case"yyyy.MM.dd":return a=t.split("."),n=new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]));case"yyyy.MMM.dd":return a=t.split("."),n=new Date(parseInt(a[0]),s(a[1]),parseInt(a[2]));case"yyyy/MM/dd":return a=t.split("/"),n=new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]));case"yyyy/MMM/dd":return a=t.split("/"),n=new Date(parseInt(a[0]),s(a[1]),parseInt(a[2]));default:return a=t.split("-"),n=new Date(parseInt(a[2]),s(a[1]),parseInt(a[0]))}}function a(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function r(e){var t=document.getElementById(e.options.id);t&&y(t,"click",e.showPicker,!1)}function d(e){return m[parseInt(e)-1]}function s(e){var t=e.charAt(0).toUpperCase()+e.substr(1,e.length-1).toLowerCase();return m.indexOf(t)}function o(e,t){return[31,c(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]}function i(e,t,n){return new Date(n,t,e).getDay()}function c(e){return e%100===0?e%400===0:e%4===0}function l(e){return!(!e||!e.querySelector(".foopicker"))}function y(e,t,n,a){p?e&&e.addEventListener(t,n,a):e&&e.attachEvent("on"+t,n)}function u(e,t,n,a){p?e&&e.removeEventListener(t,n,a):e&&e.detachEvent("on"+t,n)}var p=window.addEventListener,h=["M","T","W","T","F","S","S"],m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f={date:new Date,day:function(){return this.date.getDay()},today:function(){return this.date.getDate()},month:function(){return this.date.getMonth()},year:function(){return this.date.getFullYear()},getCurrentYear:function(){return(new Date).getFullYear()},rowPadding:function(){var e=i(1,this.month(),this.year());return[6,0,1,2,3,4,5][e]},buildHeader:function(){return'<div class="foopicker__header"><div class="foopicker__arrow foopicker__arrow--prev"></div><div class="foopicker__date">'+this.buildMonths()+"&nbsp;&nbsp;"+this.buildYears()+'</div><div class="foopicker__arrow foopicker__arrow--next"></div></div>'},buildMonths:function(){for(var e='<select class="foopicker__date--month">',t=this.month(),n=0;n<m.length;n++)e+='<option value="'+n+'"',n===t&&(e+=" selected"),e+=">"+m[n]+"</option>";return e+="</select>"},buildYears:function(){for(var e='<select class="foopicker__date--year">',t=this.getCurrentYear(),n=this.year(),a=n;t+5>=a;a++)e+='<option value="'+a+'"',a===n&&(e+=" selected"),e+=">"+a+"</option>";return e+="</select>"},buildCalendar:function(){var e,t=o(this.year(),this.month()),n='<div class="foopicker__calendar"><table><tr>';for(e=0;e<h.length;e++)n+='<td><div class="foopicker__week">'+h[e]+"</div></td>";n+="</tr><tr>";for(var a=0,r="",d=0-this.rowPadding();t>d;d++)0>d?n+="<td></td>":(r=d===this.today()-1?"foopicker__day--today":"",n+='<td><div class="foopicker__day '+r+'" ',n+='data-day="'+(d+1)+'" data-month="'+(this.month()+1),n+='" data-year="'+this.year()+'" ',n+=">"+(d+1)+"</div></td>"),a++,a%7===0&&(a=0,n+="</tr><tr>");return n+="</tr></table></div>"},addListeners:function(e){var t=e.options.id,n=document.getElementById("foopicker-"+t);if(n){var a=n.getElementsByClassName("foopicker__arrow--prev")[0],r=n.getElementsByClassName("foopicker__arrow--next")[0];y(a,"click",e.changeMonth,!1),y(r,"click",e.changeMonth,!1);var d=n.getElementsByClassName("foopicker__date--month")[0],s=n.getElementsByClassName("foopicker__date--year")[0];y(d,"change",this.handleMonthChange.bind(null,e),!1),y(s,"change",this.handleYearChange.bind(null,e),!1)}this.changeInstanceDate(e),this.modifyDateClass(e);var o=n.getElementsByClassName("foopicker__day");if(o&&o.length)for(var i=0;i<o.length;i++)if("function"!=typeof o[i].onclick&&o[i].className&&-1===o[i].className.indexOf("foopicker__day--disabled")){var c=document.getElementById(t+"-foopicker__day--"+(i+1));y(c,"click",e.selectDate,!1)}},handleMonthChange:function(e,t){e.updateCalendar(t.target.value)},handleYearChange:function(e,t){e.updateCalendar(e.currentMonth,t.target.value)},removeListeners:function(e){var t=e.options.id,n=document.getElementById("foopicker-"+t);if(n){var a=n.getElementsByClassName("foopicker__date--month")[0],r=n.getElementsByClassName("foopicker__date--year")[0];a.removeEventListener("change",this.handleMonthChange,!1),r.removeEventListener("change",this.handleYearChange,!1)}},modifyDateClass:function(e){var n,a,r,d=e.options.id,s=e.selectedDay,o=new Date,i=o.getMonth(),c=o.getFullYear(),l=document.getElementById("foopicker-"+d);if(l){var y=l.getElementsByClassName("foopicker__day");if(y&&y.length)for(var u=0;u<y.length;u++)a="",n=t(e,y[u].dataset.day,y[u].dataset.month,y[u].dataset.year),e.options.disable&&-1!==e.options.disable.indexOf(n)&&(a="foopicker__day--disabled"),y[u].className="foopicker__day",u+1===s&&this.month()===e.selectedMonth-1&&this.year()===e.selectedYear?y[u].className+=" foopicker__day--selected "+a:(r=y[u].dataset.day===this.today()&&i===this.month()&&c===this.year()?" foopicker__day--today":"",y[u].className+=r+" "+a),u+1===o.getDate()&&this.month()===i&&this.year()===c&&y[u].classList.add("foopicker__day--today"),y[u].id=d+"-foopicker__day--"+(u+1)}},changeInstanceDate:function(e){e.currentDay=this.day(),e.currentDate=this.today(),e.currentMonth=this.month(),e.currentYear=this.year()}};return e}();
